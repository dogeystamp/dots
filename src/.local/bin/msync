#!/bin/sh

# Use go-mtpfs to sync files from an Android device

set -e

while getopts ":pr" o; do
	case "${o}" in
		p) ACTION=PUSH ;;
		r) ACTION=RECV ;;
	esac
done

MNT="$HOME/quar/mnt"
ROOT="$MNT/Internal shared storage"

imp () {
	find "$1" -type f | xargs -I{} mv "{}" "$2"
}

impf () {
	find "$1" -mindepth 1 -maxdepth 1 | xargs -I{} mv "{}"/ "$2"
}

exp () {
	find "$1" -type f | xargs -I{} cp -n "{}" "$2"
}

if [ $ACTION = PUSH ]
then
	# Optionally send sorted files back

	exp ~/med/memes/woof/ "$ROOT/Pictures/memes/"
	exp ~/med/memes/bork/ "$ROOT/Pictures/memes2/"
	exp ~/med/rw/sch/ "$ROOT/Pictures/rw/sch/"
	exp ~/med/sticker/ "$ROOT/Pictures/sticker/"
fi

if [ $ACTION = RECV ]
then
	# Move files to the quarantine zone for categorisation and renaming

	imp "$ROOT/Pictures/Infinity/" ~/quar
	imp "$ROOT/Pictures/Screenshots/" ~/quar

	imp "$ROOT/Movies/Infinity/" ~/quar

	imp "$ROOT/DCIM/OpenCamera/" ~/quar
	imp "$ROOT/DCIM/Camera/" ~/quar

	imp "$ROOT/Recordings/Sound records/" ~/quar

	imp "$ROOT/Documents/dr" ~/quar

	imp "$ROOT/Documents/contacts.vcf" ~/quar
	imp "$ROOT/infbk/" ~/quar/infinity/
	impf "$ROOT/.SeedVaultAndroidBackup/" ~/quar/seedvault/
fi
