#!/bin/sh

# Sync files to the main device for categorisation and renaming.

while getopts ":pr" o; do
	case "${o}" in
		p) ACTION=PUSH ;;
		r) ACTION=RECV ;;
	esac
done


# Setup ssh agent to avoid repeated password prompts
eval `ssh-agent -s`

ssh-add ~/.ssh/keys/gamma

if [ $ACTION = PUSH ]
then
	# Optionally send sorted files back
	echo Push action is not implemented.
fi

if [ $ACTION = RECV ]
then
	# Move files to the quarantine zone for categorisation and renaming

	rsync -avPzc gamma:~/storage/pictures/Infinity/ ~/quar && \
		ssh gamma "rm -I storage/pictures/Infinity/*"

	rsync -avPzc gamma:~/storage/movies/Infinity/ ~/quar && \
		ssh gamma "rm -I storage/movies/Infinity/*"

	rsync -avPzc gamma:~/storage/dcim/Camera/ ~/quar && \
		ssh gamma "rm -I storage/dcim/Camera/*"

	rsync -avPzc "gamma:~/storage/shared/Recordings/Sound records/" ~/quar && \
		ssh gamma "rm -I storage/shared/Recordings/Sound\ records/*"
fi

# Kill ssh agent
kill $SSH_AGENT_PID
